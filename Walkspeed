local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local speedValue = 16
local jumpValue = 50
local flyEnabled = false
local minSpeed, maxSpeed = 1, 100
local minJump, maxJump = 10, 300

local oldGui = playerGui:FindFirstChild("SpeedGUI")
if oldGui then oldGui:Destroy() end

local gui = Instance.new("ScreenGui", playerGui)
gui.Name = "SpeedGUI"
gui.ResetOnSpawn = false

local function fadeCreditSequence()
    local credit = Instance.new("TextLabel", gui)
    credit.Size = UDim2.new(0, 350, 0, 40)
    credit.Position = UDim2.new(0.5, -175, 0, 10)
    credit.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    credit.BackgroundTransparency = 0.2
    credit.TextColor3 = Color3.fromRGB(255, 215, 0)
    credit.Font = Enum.Font.GothamBold
    credit.TextScaled = true
    Instance.new("UICorner", credit).CornerRadius = UDim.new(0, 10)

    credit.Text = "Hey! This script is made by MNDEV!"
    task.wait(10)
    for i = 1, 20 do
        credit.TextTransparency = i / 20
        credit.BackgroundTransparency = 0.2 + (i / 20)
        task.wait(0.05)
    end

    credit.TextTransparency = 0
    credit.BackgroundTransparency = 0.2
    credit.Text = "If you lost the GUI just reâ€‘execute the script!"
    task.wait(10)
    for i = 1, 20 do
        credit.TextTransparency = i / 20
        credit.BackgroundTransparency = 0.2 + (i / 20)
        task.wait(0.05)
    end

    credit:Destroy()
end

task.spawn(fadeCreditSequence)

local frame = Instance.new("Frame", gui)
frame.Name = "MainFrame"
frame.Size = UDim2.new(0, 300, 0, 220)
frame.Position = UDim2.new(0, 20, 0, 20)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BackgroundTransparency = 0.25
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)
Instance.new("UIStroke", frame).Color = Color3.fromRGB(255, 215, 0)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.Position = UDim2.new(0, 0, 0, 0)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 20
title.TextColor3 = Color3.fromRGB(255, 215, 0)
title.Text = "Speed Modification ðŸš€"

local valueLabel = Instance.new("TextLabel", frame)
valueLabel.Size = UDim2.new(1, -20, 0, 30)
valueLabel.Position = UDim2.new(0, 10, 0, 40)
valueLabel.BackgroundTransparency = 1
valueLabel.Font = Enum.Font.Gotham
valueLabel.TextSize = 18
valueLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
valueLabel.Text = "Speed: " .. speedValue

local minus = Instance.new("TextButton", frame)
minus.Size = UDim2.new(0, 50, 0, 35)
minus.Position = UDim2.new(0, 10, 0, 80)
minus.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
minus.Font = Enum.Font.GothamBold
minus.TextSize = 26
minus.TextColor3 = Color3.new(1, 1, 1)
minus.Text = "-"
Instance.new("UICorner", minus).CornerRadius = UDim.new(0, 6)

local plus = Instance.new("TextButton", frame)
plus.Size = UDim2.new(0, 50, 0, 35)
plus.Position = UDim2.new(0, 240, 0, 80)
plus.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
plus.Font = Enum.Font.GothamBold
plus.TextSize = 26
plus.TextColor3 = Color3.new(1, 1, 1)
plus.Text = "+"
Instance.new("UICorner", plus).CornerRadius = UDim.new(0, 6)

local flyToggle = Instance.new("TextButton", frame)
flyToggle.Size = UDim2.new(0, 120, 0, 35)
flyToggle.Position = UDim2.new(0.5, -60, 0, 80)
flyToggle.BackgroundColor3 = Color3.fromRGB(0, 180, 0)
flyToggle.Font = Enum.Font.GothamBold
flyToggle.TextSize = 16
flyToggle.TextColor3 = Color3.new(1, 1, 1)
flyToggle.Text = "Toggle Flying"
flyToggle.Visible = false
Instance.new("UICorner", flyToggle).CornerRadius = UDim.new(0, 6)

local function createTabButton(name, posX, label)
    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(0.33, -6, 0, 30)
    btn.Position = UDim2.new(posX, 0, 1, -40)
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.TextColor3 = Color3.fromRGB(255, 215, 0)
    btn.Text = label
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
    return btn
end

local speedTab = createTabButton("Speed", 0, "Speed Tab ðŸš€")
local jumpTab = createTabButton("Jump", 0.33, "Jump Tab ðŸ¦˜")
local flyTab = createTabButton("Fly", 0.66, "Fly Tab ðŸ•Šï¸")

local mode = "Speed"

local function updateUI()
    if mode == "Speed" then
        title.Text = "Speed Modification ðŸš€"
        minus.Visible = true
        plus.Visible = true
        flyToggle.Visible = false
        valueLabel.Text = "Speed: " .. speedValue
    elseif mode == "Jump" then
        title.Text = "Jump Power Modification ðŸ¦˜"
        minus.Visible = true
        plus.Visible = true
        flyToggle.Visible = false
        valueLabel.Text = "Jump Power: " .. jumpValue
    else
        title.Text = "Fly Mode ðŸ•Šï¸"
        minus.Visible = false
        plus.Visible = false
        flyToggle.Visible = true
        valueLabel.Text = flyEnabled and "Flying: ON" or "Flying: OFF"
    end
end

minus.MouseButton1Click:Connect(function()
    if mode == "Speed" and speedValue > minSpeed then
        speedValue -= 1
    elseif mode == "Jump" and jumpValue > minJump then
        jumpValue -= 5
    end
    updateUI()
end)

plus.MouseButton1Click:Connect(function()
    if mode == "Speed" and speedValue < maxSpeed then
        speedValue += 1
    elseif mode == "Jump" and jumpValue < maxJump then
        jumpValue += 5
    end
    updateUI()
end)

speedTab.MouseButton1Click:Connect(function()
    mode = "Speed"
    updateUI()
end)

jumpTab.MouseButton1Click:Connect(function()
    mode = "Jump"
    updateUI()
end)

flyTab.MouseButton1Click:Connect(function()
    mode = "Fly"
    updateUI()
end)

local bodyVel, bodyGyro

local function startFly(char)
    if not char then return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local humanoid = char:FindFirstChild("Humanoid")
    if not hrp or not humanoid then return end
    humanoid.PlatformStand = true

    bodyVel = Instance.new("BodyVelocity")
    bodyVel.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bodyVel.Velocity = Vector3.new(0, 0, 0)
    bodyVel.Parent = hrp

    bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
    bodyGyro.CFrame = hrp.CFrame
    bodyGyro.Parent = hrp
end

local function stopFly(char)
    if not char then return end
    local humanoid = char:FindFirstChild("Humanoid")
    if humanoid then
        humanoid.PlatformStand = false
    end
    if bodyVel then
        bodyVel:Destroy()
        bodyVel = nil
    end
    if bodyGyro then
        bodyGyro:Destroy()
        bodyGyro = nil
    end
end

flyToggle.MouseButton1Click:Connect(function()
    flyEnabled = not flyEnabled
    updateUI()
    if flyEnabled then
        startFly(player.Character)
    else
        stopFly(player.Character)
    end
end)

local function getMoveDirection(char)
    if char and char:FindFirstChild("Humanoid") then
        return char.Humanoid.MoveDirection
    end
    return Vector3.new(0,0,0)
end

RunService.RenderStepped:Connect(function()
    if flyEnabled and mode == "Fly" then
        local char = player.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            local hrp = char.HumanoidRootPart
            local cam = workspace.CurrentCamera
            
            -- flySpeed syncs with speedValue
            local flySpeed = speedValue
            
            -- Get normalized move direction (from joystick on mobile too)
            local moveDir = getMoveDirection(char)
            if moveDir.Magnitude > 0 then
                -- Correct the direction by rotating moveDir to camera space
                local camYRot = Vector3.new(cam.CFrame.LookVector.X, 0, cam.CFrame.LookVector.Z).Unit
                local correctedDir = (cam.CFrame - cam.CFrame.Position):VectorToWorldSpace(moveDir)
                
                -- Apply velocity in corrected direction multiplied by speed
                bodyVel.Velocity = correctedDir.Unit * flySpeed
            else
                -- No input, no movement but keep floating
                bodyVel.Velocity = Vector3.new(0, 0, 0)
            end
            
            -- Keep the bodyGyro to face camera direction
            bodyGyro.CFrame = CFrame.new(hrp.Position, hrp.Position + cam.CFrame.LookVector)
        end
    end
end)

RunService.Heartbeat:Connect(function()
    local char = player.Character
    if char and char:FindFirstChild("Humanoid") then
        local humanoid = char.Humanoid
        humanoid.WalkSpeed = speedValue
        humanoid.JumpPower = jumpValue
        if flyEnabled and mode ~= "Fly" then
            flyEnabled = false
            stopFly(char)
            updateUI()
        end
    end
end)

updateUI()
